<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ad-Hockery - Semi-RESTful Scaffolded Controllers</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/stylesheets/adhockery.css">
    <link rel="stylesheet" href="/stylesheets/prism.css">
    <script src="/javascripts/modernizr.custom.js"></script>
    <script src="//use.edgefonts.net/ultra;league-gothic.js"></script>
  </head>
  <body>

    <header id="site-header">
      <h1 class="logo"><a href="/">Ad-Hockery</a></h1>
      <dl class="strapline">
        <dt>ad-hockery: <em>/ad·hok'@r·ee/</em>, n.</dt>
        <dd>Gratuitous assumptions... which lead to the appearance of semi-intelligent behavior but are in fact entirely arbitrary. <cite><a href="http://www.retrologic.com/jargon/A/ad-hockery.html">Jargon File</a></cite>
      </dl>
    </header>

    <main>
        <article>
    <header>
      <time datetime="2012-02-07T10:56:00">Feb  7 2012</time>
      <h1>Semi-RESTful Scaffolded Controllers</h1>
    </header>
    <div class="paragraph">
<p>The default Grails scaffolded controllers use a <em>create</em> action to render a form and a <em>save</em> action as the target the form will <em>POST</em> to. If the <em>save</em> action succeeds it redirects to <em>show</em> and if it fails due to constraint violations it re-renders the form. The same applies to editing with the <em>edit</em> and <em>update</em> actions.</p>
</div>
<div class="paragraph">
<p>There&#8217;s a slight quirk here in that a failed <em>save</em> will cause the URL to change from <em>/controllerName/create</em> to <em>/controllerName/save</em>. Not a particularly huge issue, after all it&#8217;s not something a search spider will see and users will be very unlikely to care. One thing I have found problematic though is when rendering a navigation element that highlights an item based on the current action.</p>
</div>

<div class="paragraph">
<p>Imagine a bit of GSP code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="markup language-markup">&lt;nav&gt;
    &lt;g:link action="list" class="${actionName == 'list' ? 'active' : ''}"&gt;List Cocktails&lt;/g:link&gt;
    &lt;g:link action="create" class="${actionName == 'create' ? 'active' : ''}"&gt;Create Cocktail&lt;/g:link&gt;
    &lt;g:link action="search" class="${actionName == 'search' ? 'active' : ''}"&gt;Search Cocktails&lt;/g:link&gt;
&lt;/nav&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a navigation element with links to the various controller actions &amp; highlights the current action. However, if we&#8217;ve submitted bad data from the <em>create</em> form no navigation element will be highlighted. With scaffolding this is easy to fix by changing the test to <code>actionName in ['create', 'save']</code> but with custom controllers the relationship between actions might not always be so predictable and the navigation template will need frequent tweaking to stay up to date as the code evolves.</p>
</div>
<div class="paragraph">
<p>With the <a href="http://grails-twitter-bootstrap.cloudfoundry.com">Twitter Bootstrap scaffolding example</a> I created recently I used a different pattern in the scaffolded controller template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">def create() {
    switch (request.method) {
    case 'GET':
        // render the form
    case 'POST':
        // save the object
        // if successful redirect
        // otherwise re-render the form
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Effectively I&#8217;ve merged the <em>create</em> and <em>save</em> actions. The form posts back to the <em>create</em> action instead of <em>save</em>. This means the URL only changes when we successfully redirect away from creating our object &amp; the <em>create</em> navigation entry stays highlighted if we screw up creating our object.</p>
</div>
<div class="paragraph">
<p>I&#8217;ve done the same with the <em>edit</em> and <em>update</em> actions. Have a look at <a href="https://github.com/robfletcher/twitter-bootstrap-scaffolding/blob/master/src/templates/scaffolding/Controller.groovy#L16">the full source on GitHub</a> if you&#8217;re interested.</p>
</div>
<div class="paragraph">
<p>It feels like a step closer to a RESTful interface. I&#8217;m using the HTTP verbs to determine what to do with requests to the same URL. Full RESTful mapping isn&#8217;t possible as forms will only <em>GET</em> or <em>POST</em> not <em>PUT</em> or <em>DELETE</em>. Also using <a href="http://grails.org/doc/latest/guide/theWebLayer.html#mappingHTTP">Grails' RESTful URL mappings</a> would defeat the point as the action name in the GSP would be different.</p>
</div>
<div class="paragraph">
<p>This is neat enough but a couple of objections occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>I don&#8217;t particularly like the switch statement, but controller actions should be kept trivial anyway (controllers are for routing requests around, not performing complex logic).</p>
</li>
<li>
<p>Unit testing becomes marginally more awkward as we have to set <code>request.method</code> rather than just invoking a different action.</p>
</li>
<li>
<p>This is a sledgehammer to crack a nut &amp; only a pedant would care. Yeah, fair enough.</p>
</li>
</ul>
</div>
    <footer>
      <ul class="tag-list">
          <li><a href="/tags/grails/">grails</a></li>
          <li><a href="/tags/rest/">rest</a></li>
      </ul>
    </footer>
  </article>

    </main>

    <footer id="site-footer">
      <nav>
        <a href="/">Home</a>
        <a href="/about">About</a>
        <a href="/archive">Archive</a>
      </nav>
    </footer>

    <script src="/javascripts/adhockery.js"></script>
  </body>
</html>

<div id="disqus_thread"></div>
            <script type="text/javascript">
            //<![CDATA[
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//adhockery.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            //]]>
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </script>
