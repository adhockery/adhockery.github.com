<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ad-Hockery</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/Icon.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/Icon@2x.png">
    <link rel="stylesheet" href="/stylesheets/adhockery.css">
    <link rel="stylesheet" href="/stylesheets/prism.css">
    <script src="/javascripts/modernizr.custom.js"></script>
    <script src="//use.edgefonts.net/ultra;league-gothic.js"></script>
  </head>
  <body>

    <header>
      <h1 class="logo"><a href="/">Ad-Hockery</a></h1>
      <dl class="strapline">
        <dt>ad-hockery: <em>/ad·hok'@r·ee/</em>, n.</dt>
        <dd>Gratuitous assumptions... which lead to the appearance of semi-intelligent behavior but are in fact entirely arbitrary. <cite><a href="http://www.retrologic.com/jargon/A/ad-hockery.html">Jargon File</a></cite>
      </dl>
    </header>

    <div class="container">
      <main>
          <article>
    <header>
      <time datetime="2011-12-23T10:24:00">Dec 23 2011</time>
      <h2><a href="/2011/12/23/wiring-taglib-dependencies-in-unit-tests/">Wiring taglib dependencies in Grails 2 unit tests</a></h2>
    </header>
    <div class="paragraph">
<p>Grails 2 has made a lot of improvements in unit testing support. One of the things I always used to find particularly painful was unit testing taglibs. Now when your test class is annotated with <code>@TestFor(MyTagLib)</code> you can use the <code>applyTemplate</code> method like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">expect:
applyTemplate('&lt;my:tag/&gt;') == 'the expected output'</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, one thing I found is that it&#8217;s quite tricky to wire a dependency in to the taglib instance that&#8217;s used by the <code>applyTemplate</code> method.</p>
</div>

    <a class="read-more" href="/2011/12/23/wiring-taglib-dependencies-in-unit-tests/">Read more…</a>
  </article>
  <hr>
  <article>
    <header>
      <time datetime="2011-11-30T23:27:00">Nov 30 2011</time>
      <h2><a href="/2011/11/30/organizing-functional-tests/">Organizing functional tests</a></h2>
    </header>
    <div class="paragraph">
<p>I posted a few days ago <a href="http://blog.freeside.co/post/42903299940/fear-loathing-in-functional-testing-land">about functional testing &amp; some of my frustrations</a>, focusing mainly on the technical issues. I did touch on test organization in terms of modelling behaviour rather than page structure. As <a href="http://ldaley.com/post/13251886270/in-response-to-robs-post-on-functional-testing">Luke Daley has pointed out</a> the two aren&#8217;t fundamentally in opposition and I&#8217;ve been giving this some further thought.</p>
</div>

    <a class="read-more" href="/2011/11/30/organizing-functional-tests/">Read more…</a>
  </article>
  <hr>
  <article>
    <header>
      <time datetime="2011-11-29T00:07:00">Nov 29 2011</time>
      <h2><a href="/2011/11/29/grails-2-upgrade-part-1/">Upgrading to Grails 2: Part 1</a></h2>
    </header>
    <div class="paragraph">
<p>We&#8217;ve recently spent some time ensuring that our application is forwards-compatible with the upcoming Grails 2. Our app is broadly split into the application itself and a large plugin that forms the core of our <a href="http://en.wikipedia.org/wiki/Content_management_system">CMS</a>. We upgraded the plugin first as it contains the core domain classes but is also a slightly smaller task to tackle. I&#8217;ll write up our findings when we&#8217;ve completed upgrading the application itself in a follow-up to this post.</p>
</div>

    <a class="read-more" href="/2011/11/29/grails-2-upgrade-part-1/">Read more…</a>
  </article>
  <hr>
  <article>
    <header>
      <time datetime="2011-11-24T00:59:00">Nov 24 2011</time>
      <h2><a href="/2011/11/24/fear-loathing-in-functional-testing-land/">Fear & loathing in functional testing land</a></h2>
    </header>
    <div class="paragraph">
<p>As projects grow the two things I&#8217;ve repeatedly found to be particularly painful have been functional testing and data fixtures. I might write up some thoughts on data fixtures another time but what follows is a brain-dump of my troubled relationship with functional testing.</p>
</div>
<div class="paragraph">
<p><em>Disclaimers:</em> I have more questions than answers and I&#8217;m completely open to the idea that <em>I&#8217;m doing it all wrong</em>. I&#8217;m not trying to diss any tool or technique here. I have spent a lot of time over the last few years writing functional test coverage so I think I at least have some perspective on the issues if no clue how to solve them.</p>
</div>

    <a class="read-more" href="/2011/11/24/fear-loathing-in-functional-testing-land/">Read more…</a>
  </article>
  <hr>
  <article>
    <header>
      <time datetime="2011-08-26T17:19:00">Aug 26 2011</time>
      <h2><a href="/2011/08/26/grails-gotcha-beware-head-requests-when-rendering/">Grails Gotcha: Beware HEAD requests when rendering binary output in controllers</a></h2>
    </header>
    <div class="paragraph">
<p>Although most Grails controllers render HTML, JSON or XML output it is possible to use them to render binary data as well. We use a controller to render images uploaded by editors into our content management interface. The theory is simple enough, instead of using the <code>render</code> dynamic method or returning a <em>model</em> the controller action just writes bytes directly to the HTTP response stream. Our action looked something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">def show = {
    def image = Image.read(params.id)
    if (image) {
        response.contentType = image.contentType
        response.outputStream.withStream { stream -&gt;
            stream &lt;&lt; image.bytes
        }
    } else {
        response.sendError SC_NOT_FOUND
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This seemed to work well enough. However when writing a test I noticed an odd thing. I was using <a href="http://groovy.codehaus.org/modules/http-builder/doc/rest.html">RESTClient</a> to scrape resource URLs out of and make a <em>HEAD</em> request against them to ensure the URLs were valid. Javascript and CSS files were working fine but all the non-static images in the page were getting 404s.</p>
</div>

    <a class="read-more" href="/2011/08/26/grails-gotcha-beware-head-requests-when-rendering/">Read more…</a>
  </article>
  <hr>
  <article>
    <header>
      <time datetime="2011-08-18T21:42:00">Aug 18 2011</time>
      <h2><a href="/2011/08/18/data-driven-variation-with-spock/">Data-driven variation with Spock</a></h2>
    </header>
    <div class="paragraph">
<p>Spock&#8217;s <code>where:</code> block is commonly used with a <a href="https://github.com/robfletcher/grails-enhanced-scaffolding/blob/master/test/projects/scaffolding-example/test/functional/scaffolding/InputTypesSpec.groovy#L18">data table</a> but can also be driven by any <code>Iterable</code> data. It&#8217;s worth bearing in mind that the data driving the <code>where:</code> block doesn&#8217;t have to be hardcoded, it can be dynamic. For example, today we implemented a spec to ensure that every table in our database schema has a primary key (because it&#8217;s required by <a href="http://ha-jdbc.sourceforge.net/">HA-JDBC</a> and not automatically added by GORM on join tables).</p>
</div>

    <a class="read-more" href="/2011/08/18/data-driven-variation-with-spock/">Read more…</a>
  </article>
  <hr>
  <article>
    <header>
      <time datetime="2011-08-02T13:01:00">Aug  2 2011</time>
      <h2><a href="/2011/08/02/avoiding-accidental-i18n-in-grails/">Avoiding accidental i18n in Grails</a></h2>
    </header>
    <div class="paragraph">
<p>We’re developing an app that’s exclusively for a UK audience so i18n really isn’t an issue for us. However recently we got bitten by some i18n creeping in where we didn’t want it. Specifically, when using Grails’ <code>g:dateFormat</code> tag the default behaviour is to format the date according to the <code>Locale</code> specified in the user’s <code>Accept-Language</code> header. Even though we are explicitly specifying a format pattern for the date Java is aware of localized day names for some languages so the output can vary. The result is that on a page full of English text there suddenly appears a Spanish or Swedish day name. What makes things worse is that as we use server-side content caching and a CDN if a user with a non-English <code>Accept-Language</code> header is the first to see a particular page or bit of dynamically retrieved content then the cache is primed and until it expires <em>everyone</em> will see the non-English day name text. The solution in a Grails app is as simple as replacing Spring’s standard <code>localeResolver</code> bean with an instance of <code>FixedLocaleResolver</code>. Just add the following to <em>grails-app/conf/spring/resources.groovy</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">localeResolver(org.springframework.web.servlet.i18n.FixedLocaleResolver, Locale.UK)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This changes the way Spring works out the request locale and any locale-aware tags should just fall into place.</p>
</div>
    <a class="read-more" href="/2011/08/02/avoiding-accidental-i18n-in-grails/">Read more…</a>
  </article>
  <hr>
  <article>
    <header>
      <time datetime="2011-05-21T21:59:00">May 21 2011</time>
      <h2><a href="/2011/05/21/resources-plugin-and-modular-web-components-for-grails/">Resources plugin and modular web components for Grails apps</a></h2>
    </header>
    <div class="paragraph">
<p>I recently gave a talk on <a href="http://www.eu2011.gr8conf.org/talk/progressive-uis"><em>Building progressive UIs with Grails</em></a> at <a href="http://www.eu2011.gr8conf.org/">gr8conf</a> in Copenhagen and was really pleased with the feedback &amp; comments I received afterwards. There was a question asked at the end that I felt in retrospect I could have answered better, though. I had mentioned that the Grails <a href="http://grails.org/doc/latest/guide/6.%20The%20Web%20Layer.html#6.7%20Ajax">AJAX tags</a> were something that should be avoided as they write script blocks directly into the page and event handlers directly onto HTML elements. I was pitching an approach based on a clean separation of clean semantic markup and script enhancements and inline script violates that separation.</p>
</div>

    <a class="read-more" href="/2011/05/21/resources-plugin-and-modular-web-components-for-grails/">Read more…</a>
  </article>
  <hr>
  <article>
    <header>
      <time datetime="2011-03-26T16:25:00">Mar 26 2011</time>
      <h2><a href="/2011/03/26/css-box-model-hacking/">CSS box model hacking</a></h2>
    </header>
    <div class="paragraph">
<p>Want to make an HTML element fill 100% of its parent&#8217;s width but also give it a border and/or some padding? Since the width of an element is <em>exclusive</em> of its border and padding this can be a pain. However there&#8217;s a fairly simple CSS solution that works cross-browser.</p>
</div>

    <a class="read-more" href="/2011/03/26/css-box-model-hacking/">Read more…</a>
  </article>
  <hr>
  <article>
    <header>
      <time datetime="2011-03-25T00:10:00">Mar 25 2011</time>
      <h2><a href="/2011/03/25/styling-with-html5-form-validation/">Styling with HTML5 form validation</a></h2>
    </header>
    <div class="paragraph">
<p>HTML5 specifies a number of enhancements to form inputs that are gradually being implemented by newer browsers. Among the enhancements is support for some level of automatic form validation. When inputs have invalid values the browser may refuse to submit the form. Currently Opera, Safari, Chrome and Firefox 4 have some support for this. IE8 does not. I haven&#8217;t experimented with IE9 yet.</p>
</div>

    <a class="read-more" href="/2011/03/25/styling-with-html5-form-validation/">Read more…</a>
  </article>
  <hr>

  <nav class="pagination">
      <a rel="prev" href="/page/4/">Previous</a>
    <span class="current">5 of 11</span>
      <a rel="next" href="/page/6/">Next</a>
  </nav>

      </main>

      <footer>
        <nav>
          <a href="/">Home</a>
          <a href="/about">About</a>
          <a href="/archive">Archive</a>
        </nav>
      </footer>
    </div>

    <script src="/javascripts/adhockery.js"></script>
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-27275689-1', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>
