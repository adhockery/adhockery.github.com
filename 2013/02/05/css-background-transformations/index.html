<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ad-Hockery - CSS background transformations</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/stylesheets/adhockery.css">
    <link rel="stylesheet" href="/stylesheets/prism.css">
    <script src="/javascripts/modernizr.custom.js"></script>
    <script src="//use.edgefonts.net/ultra;league-gothic.js"></script>
  </head>
  <body>

    <header>
      <h1 class="logo"><a href="/">Ad-Hockery</a></h1>
      <dl class="strapline">
        <dt>ad-hockery: <em>/ad·hok'@r·ee/</em>, n.</dt>
        <dd>Gratuitous assumptions... which lead to the appearance of semi-intelligent behavior but are in fact entirely arbitrary. <cite><a href="http://www.retrologic.com/jargon/A/ad-hockery.html">Jargon File</a></cite>
      </dl>
    </header>

    <div class="container">
      <main>
          <article>
    <header>
      <time datetime="2013-02-05T16:13:00">Feb  5 2013</time>
      <h1>CSS background transformations</h1>
    </header>
    <div class="paragraph">
<p>CSS3 includes a bunch of <code>transform</code> options allowing things like rotation &amp; distortion of element boxes. I wanted to apply that to achieve an effect inspired by <a href="https://www.google.com/images?q=googie+signage">mid 20th Century <em>Googie</em> signage</a>.</p>
</div>
<div class="paragraph">
<p>My goal was to distort just the background behind an element whilst leaving the text alone. The text should also be able to "escape" from the background, for example letters can overflow beyond the background.</p>
</div>
<div class="paragraph">
<p>Naturally, being a CSS purist I also wanted to do all this without introducing non-semantic extra elements into the document.</p>
</div>

<div class="paragraph">
<p>In order to save space I&#8217;m not using any vendor specific prefixes in the code in this article. On <em>jsFiddle</em> I&#8217;m using <a href="http://leaverou.github.com/prefixfree/">Lea Verou&#8217;s awesome <em>-prefix-free</em> library</a> if you&#8217;re applying this technique you&#8217;ll need to do the same or add the vendor prefixed versions of CSS properties like <code>transform</code> and <code>background-clip</code>.</p>
</div>
<div class="sect2">
<h3 id="_doing_it_the_dumb_way">Doing it the dumb way</h3>
<div class="paragraph">
<p>My first thought was to apply a <code>background-color</code> to the element along with the CSS3 transforms then "reverse out" the transformations in child elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="css language-css">.googie {
    background-color: lightblue;
    transform: skew(7deg, 2deg) scale(0.8) rotate(-4deg);
}
.googie &gt; * {
    transform: skew(-7deg, -2deg) scale(1.2) rotate(4deg);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the result and the <a href="http://jsfiddle.net/piraterob/sKgmM/">jsFiddle</a> code. <span class="image"><img src="http://static.tumblr.com/x4ukvcb/3Mvmhr5k9/image.jpg" alt="Transform and reverse" title="Element transformed &amp; content reverse transformed"></span></p>
</div>
<div class="paragraph">
<p>This works up to a point but the more complex the transforms the harder they are to reverse out correctly. I also found that certain transformations were effectively impossible to reverse out in this way. For example, if I apply a <code>rotate</code> transform to the element then each child element will be out of position when rotated back. It doesn&#8217;t feel like a very maintainable solution.</p>
</div>
<div class="paragraph">
<p>You can see what I mean if I add a border to the left of the various elements. They get progressively out of line as they are reverse transformed. The longer the content gets the more of a problem this becomes. <span class="image"><img src="http://static.tumblr.com/x4ukvcb/bKlmhr5r3/image.jpg" alt="Reverse transformations force elements out of line" title="Elements drift out of line using transform &amp; reverse"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_say_hello_to_the_pseudo_background_element">Say hello to the pseudo-background-element</h3>
<div class="paragraph">
<p>Instead of transforming the background of the element itself I figured the best approach would be to position another element behind the content and transform that. The advantage being that the transformations are then only applied to the background and not the element itself.</p>
</div>
<div class="paragraph">
<p>Since I didn&#8217;t want to add extra markup I decided to try this with a <code>:before</code> pseudo-element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="css language-css">.googie {
    position: relative;
}

.googie:before {
    background-color: lightblue;
    transform: skew(7deg, 2deg) scale(0.8) rotate(-4deg);

    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pseudo-element is positioned behind the actual element using <code>position: absolute</code> and <code>z-index: -1</code> and given the same dimensions as the "real" element. In order for the pseudo-element to render it requires the <code>content</code> declaration although I&#8217;m just using an empty string which seems to be enough to trigger the rendering.</p>
</div>
<div class="paragraph">
<p>The result doesn&#8217;t look particularly different from the first attempt but the code is much simpler now there&#8217;s no reverse transformation going on. <span class="image"><img src="http://static.tumblr.com/x4ukvcb/PFDmhr5tv/image.jpg" alt="Pseudo-element background" title="Pseudo background element"></span> Here&#8217;s the code on <a href="http://jsfiddle.net/piraterob/sKgmM/1/">jsFiddle</a>.</p>
</div>
<div class="paragraph">
<p>If I add a border to the content elements again you can see that they are now properly in line – the background transformation has not affected them. Win! <span class="image"><img src="http://static.tumblr.com/x4ukvcb/X2Cmhr5vr/image.jpg" alt="Using pseudo background elements are in line" title="Content is correctly aligned using pseudo background element"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_into_the_3rd_dimension">Into the 3rd dimension</h3>
<div class="paragraph">
<p>Because the transformations no longer affect the element or its content it&#8217;s possible to get a lot more ambitious. 3d transforms in particular can be used to achieve some really cool effects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="css language-css">.googie {
    position: relative;
    perspective: 350;
}

.googie:before {
    background-color: lightblue;
    transform: translateX(6px) translateY(11px) translateZ(-2px) rotateX(-25deg) rotateY(5deg) rotateZ(-4deg);

    /* ... positioning as before ... */
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of a 3D transformed background: <span class="image"><img src="http://static.tumblr.com/x4ukvcb/nWNmhr5xo/image.jpg" alt="3d transformed background" title="3D transformed background"></span> … and the code on <a href="http://jsfiddle.net/piraterob/sKgmM/2/">jsFiddle</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_inevitable_compatibility_issues">The inevitable compatibility issues</h3>
<div class="sect3">
<h4 id="_everyone_s_favorite_browser">Everyone&#8217;s favorite browser</h4>
<div class="paragraph">
<p>As ever, Internet Explorer is going to rain on our parade here as up to and including version 8 it flat out doesn&#8217;t support CSS transforms. IE9 will do 2d transforms (using the <code>-ms-</code> vendor prefix) but not 3d. IE10 has partial 3d transform support but I&#8217;m not exactly sure what that means in practice.</p>
</div>
</div>
<div class="sect3">
<h4 id="_keeping_the_background_in_the_back">Keeping the background in the back</h4>
<div class="paragraph">
<p>Some browsers will allow parts of the 3d transformed background to project "<em>through</em>" the content and either block mouse clicks or actually obscure the content. The former is a big problem if you have anchors in the content as you won&#8217;t be able to click them. Even <code>:hover</code> styles won&#8217;t trigger. <a href="https://twitter.com/tim_yates/status/294487820435865600">Tim Yates provided me with a workaround</a> which is to add <code>pointer-events: none;</code> to the pseudo-element&#8217;s CSS.</p>
</div>
<div class="paragraph">
<p>Some browsers (at least iOS Safari &amp; Chrome, possibly others) render the transformed background so that it actually obscures the content. <span class="image"><img src="http://static.tumblr.com/x4ukvcb/N4bmhr603/image.jpg" alt="3d background projecting through content" title="3D transformed background projecting through content"></span></p>
</div>
<div class="paragraph">
<p>To prevent this you need to set the <code>transform-origin</code> property to the corner of the element <em>"closest"</em> to the front on the <em>z</em> axis. By default the origin is at the center so by moving it to the <em>"closest"</em> corner you guarantee that z-axis transformations pivot the background behind the content.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="css language-css">transform-origin: top left;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The background is no longer projecting through the content. Some more fine-tuning is required on the element position but the fundamental problem is fixed. <span class="image"><img src="http://static.tumblr.com/x4ukvcb/B5Emhr61v/image.jpg" alt="Background with transform origin set" title="3D transformed background with origin set"></span> The full example is on <a href="http://jsfiddle.net/piraterob/sKgmM/8/">jsFiddle</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_smoothing_the_edges">Smoothing the edges</h4>
<div class="paragraph">
<p>On certain browsers skewed or rotated shapes will suffer from aliasing. The standard fix is to add <code>backface-visibility: hidden;</code> to the element&#8217;s CSS. This clears things up in desktop webkit browsers for example.</p>
</div>
<div class="paragraph">
<p>Unfortunately I found adding <code>backface-visibility: hidden</code> actually <em>caused</em> aliasing on iOS. <span class="image"><img src="http://static.tumblr.com/x4ukvcb/okJmhr63c/image.jpg" alt="iOS aliasing" title="Edges aliasing on iOS"></span></p>
</div>
<div class="paragraph">
<p><a href="http://www.fngtps.com/2011/how-to-prevent-jagged-edges-when-using-css-transformation-in-mobile-safari/">One site I found</a> suggested adding padding to a wrapper element. I didn&#8217;t want to introduce any extra markup but I was able to adapt the technique to solve the problem without having to do so.</p>
</div>
<div class="paragraph">
<p>Instead of adding a wrapper element I added the padding to the pseudo-element itself then used <code>background-clip</code> to constrain the background to the content box – <em>inside</em> the padding rather than including the padding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="css language-css">.googie:before {
    padding: 2px;
    background-clip: content-box;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the code is on <a href="http://jsfiddle.net/piraterob/sKgmM/9/">jsFiddle</a>.</p>
</div>
<div class="paragraph">
<p>This clears things up perfectly on iOS. The only down-side is that if you want to add a border or drop shadow there will be a gap between the background and the border / shadow. <span class="image"><img src="http://static.tumblr.com/x4ukvcb/rlpmhr64v/image.jpg" alt="Gap between background &amp; drop shadow" title="Gap between background &amp; drop shadow"></span></p>
</div>
<div class="paragraph">
<p>One solution to this is to use an <code>:after</code> pseudo-element placed behind the <code>:before</code> pseudo-element and positioned or resized to look like a border or drop-shadow. I&#8217;ve created a simple example on <a href="http://jsfiddle.net/piraterob/sKgmM/10/">jsFiddle</a>.</p>
</div>
</div>
</div>
    <footer>
      <ul class="tag-list">
          <li><a href="/tags/css/">css</a></li>
      </ul>
    </footer>
  </article>

      </main>

      <footer>
        <nav>
          <a href="/">Home</a>
          <a href="/about">About</a>
          <a href="/archive">Archive</a>
        </nav>
      </footer>
    </div>

    <script src="/javascripts/adhockery.js"></script>
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-27275689-1', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>

<footer class="disqus">
  <div id="disqus_thread"></div>
            <script type="text/javascript">
            //<![CDATA[
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//adhockery.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            //]]>
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </script>
</footer>
